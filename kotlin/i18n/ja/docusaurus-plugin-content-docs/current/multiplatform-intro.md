---
title: "Kotlin Multiplatform入門"
---
マルチプラットフォームプログラミングのサポートは、Kotlinの主要な利点の1つです。ネイティブプログラミングの柔軟性と利点を維持しながら、[異なるプラットフォーム](multiplatform-dsl-reference#targets)向けに同じコードの作成とメンテナンスにかかる時間を削減します。

<img src="/img/kotlin-multiplatform.svg" alt="Kotlin Multiplatform" width="700" style={{verticalAlign: 'middle'}}/>

## 主要な概念を学ぶ

Kotlin Multiplatformを使用すると、モバイル、ウェブ、デスクトップなど、さまざまなプラットフォーム間でコードを共有できます。コードのコンパイル先となるプラットフォームは、_ターゲット_のリストによって定義されます。

各ターゲットには、独自の依存関係とコンパイラオプションを持つソースファイルのセットを表す対応する*ソースセット*があります。プラットフォーム固有のソースセット（たとえば、JVM用の`jvmMain`）は、プラットフォーム固有のライブラリとAPIを利用できます。

ターゲットのサブセット間でコードを共有するには、中間ソースセットが使用されます。たとえば、`appleMain`ソースセットは、すべてのAppleプラットフォーム間で共有されるコードを表します。すべてのプラットフォーム間で共有され、宣言されたすべてのターゲットにコンパイルされるコードには、独自のソースセット`commonMain`があります。これはプラットフォーム固有のAPIを使用できませんが、マルチプラットフォームライブラリを利用できます。

特定のターゲット用にコンパイルする場合、Kotlinは共通ソースセット、関連する中間ソースセット、およびターゲット固有のソースセットを組み合わせます。

このトピックの詳細については、以下を参照してください。

* [Kotlin Multiplatformプロジェクト構造の基本](multiplatform-discover-project)
* [マルチプラットフォームプロジェクト構造の高度な概念](multiplatform-advanced-project-structure)

## コード共有メカニズムを使用する

同様のターゲットのサブセット間でコードを共有する方が便利な場合があります。Kotlin Multiplatformは、*デフォルトの階層テンプレート*を使用して、それらの作成を簡素化する方法を提供します。これには、プロジェクトで指定したターゲットに基づいて作成される、事前定義された中間ソースセットのリストが含まれています。

共有コードからプラットフォーム固有のAPIにアクセスするには、別のKotlinメカニズムである*expectedとactualの宣言*を使用できます。これにより、共通コードでプラットフォーム固有のAPIを`expect`することを宣言できますが、ターゲットプラットフォームごとに個別の`actual`実装を提供できます。このメカニズムは、関数、クラス、インターフェースなど、さまざまなKotlinの概念で使用できます。たとえば、共通コードで関数を定義できますが、対応するソースセットでプラットフォーム固有のライブラリを使用してその実装を提供できます。

このトピックの詳細については、以下を参照してください。

* [プラットフォーム間でコードを共有する](multiplatform-share-on-platforms)
* [Expectedとactualの宣言](multiplatform-expect-actual)
* [階層型プロジェクト構造](multiplatform-hierarchy)

## 依存関係を追加する

Kotlin Multiplatformプロジェクトは、外部ライブラリや他のマルチプラットフォームプロジェクトに依存できます。共通コードの場合、共通ソースセットにマルチプラットフォームライブラリへの依存関係を追加できます。Kotlinは、適切なプラットフォーム固有の部分を自動的に解決して、他のソースセットに追加します。プラットフォーム固有のAPIのみが必要な場合は、対応するソースセットに依存関係を追加します。

Kotlin MultiplatformプロジェクトにAndroid固有の依存関係を追加することは、純粋なAndroidプロジェクトで追加するのと同様です。iOS固有の依存関係を扱う場合、追加の設定なしにApple SDKフレームワークをシームレスに統合できます。外部ライブラリおよびフレームワークの場合、KotlinはObjective-CおよびSwiftとの相互運用性を提供します。

このトピックの詳細については、以下を参照してください。

* [マルチプラットフォームライブラリに依存関係を追加する](multiplatform-add-dependencies)
* [Androidライブラリに依存関係を追加する](multiplatform-android-dependencies)
* [iOSライブラリに依存関係を追加する](multiplatform-ios-dependencies)

## iOSとの統合を設定する

マルチプラットフォームプロジェクトがiOSをターゲットにしている場合は、Kotlin Multiplatform共有モジュールとiOSアプリの統合を設定できます。

そのためには、iOSフレームワークを生成し、ローカルまたはリモートの依存関係としてiOSプロジェクトに追加します。

* **ローカル統合**: 特別なスクリプトを使用してマルチプラットフォームプロジェクトとXcodeプロジェクトを直接接続するか、ローカルPodの依存関係を含むセットアップにはCocoaPodsの依存関係マネージャーを使用します。
* **リモート統合**: XCFrameworksを使用してSPMの依存関係を設定するか、CocoaPodsを介して共有モジュールを配布します。

このトピックの詳細については、[iOS統合方法](multiplatform-ios-integration-overview)を参照してください。

## コンパイルを構成する

すべてのターゲットは、通常は本番環境またはテスト用など、さまざまな目的のために複数のコンパイルを持つことができますが、カスタムコンパイルを定義することもできます。

Kotlin Multiplatformを使用すると、プロジェクト内のすべてのコンパイルを構成したり、ターゲット内で特定のコンパイルを設定したり、個々のコンパイルを作成したりすることもできます。コンパイルを構成する際には、コンパイラオプションを変更したり、依存関係を管理したり、ネイティブ言語との相互運用性を構成したりできます。

このトピックの詳細については、[コンパイルを構成する](multiplatform-configure-compilations)を参照してください。

## 最終バイナリをビルドする

デフォルトでは、ターゲットは`.klib`アーティファクトにコンパイルされます。これは、Kotlin/Native自体が依存関係として使用できますが、実行したり、ネイティブライブラリとして使用したりすることはできません。ただし、Kotlin Multiplatformは、最終的なネイティブバイナリをビルドするための追加のメカニズムを提供します。

実行可能バイナリ、共有ライブラリと静的ライブラリ、またはObjective-Cフレームワークを作成できます。それぞれ異なるビルドタイプ用に構成できます。Kotlinは、iOS統合用のユニバーサル（fat）フレームワークおよびXCFrameworkをビルドする方法も提供します。

このトピックの詳細については、[ネイティブバイナリをビルドする](multiplatform-build-native-binaries)を参照してください。

## マルチプラットフォームライブラリを作成する

共通コードと、JVM、ウェブ、およびネイティブプラットフォーム向けのプラットフォーム固有の実装を含む、マルチプラットフォームライブラリを作成できます。

Kotlin Multiplatformライブラリを公開するには、Gradleビルドスクリプトで特定の構成が必要です。Mavenリポジトリと`maven-publish`プラグインを公開に使用できます。公開されると、マルチプラットフォームライブラリは、他のクロスプラットフォームプロジェクトで依存関係として使用できます。

このトピックの詳細については、[マルチプラットフォームライブラリを公開する](multiplatform-publish-lib)を参照してください。

## リファレンス

* [Kotlin Multiplatform GradleプラグインのDSLリファレンス](multiplatform-dsl-reference)
* [Kotlin Multiplatformの互換性ガイド](multiplatform-compatibility-guide)